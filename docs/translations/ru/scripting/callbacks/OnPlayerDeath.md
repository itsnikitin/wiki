---
id: OnPlayerDeath
заголовок: OnPlayerDeath
описание: Этот callback вызывается, когда игрок умирает в результате самоубийства или в результате убийства другим игроком.
тэги: ["player"]
---

## Описание

Этот callback вызывается, когда игрок умирает в результате самоубийства или в результате убийства другим игроком.

| Имя      | Описание                                                                                      |
| -------- | --------------------------------------------------------------------------------------------- |
| playerid | Идентификатор умершего игрока.                                                                |
| killerid | Идентификатор убившего игрока, или INVALID_PLAYER_ID, если его не было.                       | 
| reason   | Идентификатор причины смерти игрока.                                                          |

## Возвращает

1 - Не позволяет другим filterscripts использовать этот callback.

0 - Указывает, что этот callback будет передан в следующий filterscript.

В filterscripts он всегда вызывается первым

## Примеры

```c
new PlayerDeaths[MAX_PLAYERS];
new PlayerKills[MAX_PLAYERS];

public OnPlayerDeath(playerid, killerid, reason)
{
    SendDeathMessage(killerid, playerid, reason); // Показывает убийство в killfeed

    // Убедитесь, что killerid действителен, прежде чем делать что-либо с ним
    if (killerid != INVALID_PLAYER_ID)
    {
        PlayerKills[killerid] ++;
    }

    // Вне проверки можно обрабатывать данные для playerid (они всегда действителены)
    PlayerDeaths[playerid] ++;
    return 1;
}
```

## Примечание

:::tip

Причина вернет 37 (огнемет) из любых источников огня (например, Молотов, 18). Причина вернет 51 из любого оружия, которое вызывает взрыв (например, РПГ, граната). Вам не нужно проверять, действителен ли killerid перед его использованием в SendDeathMessage. INVALID_PLAYER_ID - допустимый параметр идентификатора убийцы в этой функции. playerid - единственный, кто может вызвать обратный вызов. (полезно знать о борьбе с фальшивой смертью)

:::

:::warning

Вы ДОЛЖНЫ проверить, действителен ли killerid (не INVALID_PLAYER_ID), прежде чем использовать его в массиве (или где-нибудь еще), так как это приведет к сбою сценария OnPlayerDeath (а не всего сценария). Это потому, что INVALID_PLAYER_ID определен как 65535, и если в массиве есть только элементы MAX_PLAYERS, например 500, вы пытаетесь получить доступ к индексу выше 499, что выходит за пределы допустимого диапазона.

:::

## Связанные функции

- [SendDeathMessage](../functions/SendDeathMessage.md): Добавляет убийство в killfeed.
- [SetPlayerHealth](../functions/SetPlayerHealth.md): Изменяет здоровье игрока.
